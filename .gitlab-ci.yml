stages:
  - test

unit-test-job:
  stage: test
  script:
    - echo "starting bashrc"
    - source /root/.bashrc
    - echo "running pytest"
    - pytest -v --junitxml=report.xml --cov=yoke -Werror
    - coverage report
    - coverage html
  allow_failure: false
  coverage: /(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/
  image: 're-registry.lanl.gov/artimis_mpmm/mpmmcicdrbot/bookworm-slim-amd64-conda-py3_12_5__2024_10_29'
  artifacts:
   paths:
     - htmlcov
   reports:
     junit: report.xml

lint-test-job:   # This job also runs in the test stage.
  stage: test    # It can run at the same time as unit-test-job (in parallel).
  script:
    - echo "starting bashrc"
    - source /root/.bashrc
    - echo "Running linting (through ruff)"
    - ruff check
    - ruff check --preview
    - ruff format --check --diff
  allow_failure: true
  image: 're-registry.lanl.gov/artimis_mpmm/mpmmcicdrbot/bookworm-slim-amd64-conda-py3_12_5__2024_10_29'